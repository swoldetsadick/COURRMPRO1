---
title: "Effects of Transmission Type on Fuel Consumption"
author: "Woldetsadick Selam Getachew"
date: "Friday, October 24, 2014"
output: html_document
---
<font face="Garamond">
```{r, echo = FALSE, results='hide', cache = TRUE}
old.loc <- Sys.getlocale("LC_TIME")
Sys.setlocale(category = "LC_TIME", locale="English")

time <- format(Sys.time(),"%a, %b %d %Y, %X")

rversion <- R.Version()
rversion <- rversion[[13]]

sysversion <- sessionInfo()
sysversion <- sysversion[2]

```

<hr width="100%" style="border: 2px double #000000" color="#FFFFFF" size="6"></hr>
<center><h1> Executive Summary</h1></center>
The following analysis was made using the mtcars data for R datasets. It was extracted from the 1974 *Motor Trend* US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles. After some initial change in data set, and summary of variables an exploratory data analysis howed that there was in fact a statistically significant difference between the mileage of automatic transmission cars and manual transmission cars. Some variables were selected using stepwise regression and AIC and fitted data using the best model generated by inclusion or exclusion of said variables and their interactions. Results showed that manual transmissions are better for mileage (or MPG). Actually the gain makes for about 9.14 mpg ceteris paribus when shfiting from automatic to Manual transmission.
The following analysis was made using the R statistic software version `r rversion` on a computer using Windows OS version `r sysversion` and completed on `r time`.<br>
<hr width="100%" style="border: 2px double #000000" color="#FFFFFF" size="6"></hr>
<h3>1. Loading, Processing and Summarizing Data</h3>
The dataset used in this analysis was extracted from the 1974 *Motor Trend* US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles. The names of the 11 variables present in the dataset, their descriptions and corresponding units are given in Table I in Annex.<br>
Looking at variable description one concludes that the variables ```cyl, vs, am, gera``` and ```carb``` should be categorical (or factor class in R) while the rest are continuous quantitative (or class numeric in R). Let's transform each variables to corresponding class. Additionally let values of variables ```vs``` and ```am``` reflect real values making variables more descriptive.
```{r, cache = TRUE, echo = TRUE}
data(mtcars); data <- mtcars # Loading data
data$vs <- ifelse(data$vs == 0, "veng", "seng"); data$am <- ifelse(data$am == 0, "auto", "manu") # Descriptive values
for(i in 1:11){if(i %in% c(2,8,9,10,11)) {data[,i] <- as.factor(data[,i])} else{data[,i] <- as.numeric(data[,i])}} # Class Change
nas <- sum(is.na(data)) # Total NAs in Data
len <- nrow(data)# Dataset dimensions
library(psych) ; a <- describe(data$mpg) 
```
The dataset has exactly ```r nas``` missing values throughout, and includes ```r len``` observations. Let's now conduct a quick summary of the variables. First, the re-partition of observation along values of variable ```cyl```, or values *4*, *6*, *8* are 11, 7 and 14 respectively. Similarly along values of variable ```am```, or values *auto* and *manu*, are 19 and 13 respectively, along values of variable ```gear```, or values *3*, *4* and *5*, distribution is 15, 12 and 5, and finally along variable ```carb``` of values *1*, *2*, *3*, *4*, *6* and *8* re-partition is 7, 10, 3, 10, 1 and 1. The re-partition of data points along values of variable ```vs```, which are *seng* and *veng*, are 14 and 18 respectively.(Data Description Paragraph in Annex)<br>
The research on 1/4 Mile Time shows that values for this variable can be deduced from weight and horsepower values. This link between these three variables makes information from one of them redundant. Here one can choose to exclude variable ```qsec``` from analysis. The minimums and maximums for variables ```disp, hp, drat```and ```wt``` are respectively, in order, 71.1 - 472.0, 52.0 - 335.0, 2.76 - 49.93, 1.51 - 5.42 for range ```r abs(71.1 - 472.0)```, ```r abs(52.0 - 335.0)```, ```r abs(2.76 - 49.93)``` and ```r abs(1.51 - 5.42)``` for each variable respectively. The mean - median pairs for the same variables in the same order are 230.7 - 196.3, 146.7 - 123.0, 3.60 - 3.69, 3.22 - 3.33. The proximity of mean and median for all variables considered tells us that mass of data on upper and lower side of mean value is nearly equal. The mpg variable has a mean of ```r a$mean``` and standard deviation ```r a$sd``` for a median of ```r a$median```. Again the near equality of mean and median suggest the equal mass of data upper and lower mean value. Maximum and minimum values are ```r a$max``` and ```r a$min``` for range ```r a$range```. A skewness of ```r a$skew``` and a kurtosis of ```r a$kurtosis``` describes in general a flat and positively skewed distribution.
<hr width="100%" style="border: 2px dashed #000000" color="#FFFFFF" size="6"></hr>
<h3>2. Exploratory Data Analysis</h3>
First a pairwise scatterplot is made in order to visualize the correlation between pairs of variables present in the data, except the ```qsec```variable which is excluded. One can see in Figure I in the Annex not only that mpg variable is correlated strongly positively with ```cyl```, ```drat``` and ```am``` variables, strongly negatively with ```hp```, ```disp```, ```wt```, ```disp```, ```vs```, and ```carb```, and weak positively with ```drat``` and ```carb``` variable, but also that correlation between the 10 other variables is strong. Note a strong positive correlation between  ```wt``` and ```cyl```, ```wt``` and ```hp```, ```hp``` and ```cyl```, a strong negative correlation between ```wt``` and ```am```, and absence of correlation between ```hp``` and ```am``` and ```cyl``` and ```am```.<br>
The two variables of interest here are ```mpg``` and ```am``` because the study is about the impact of transmission on consumption. There seem to be a positive correlation between the two variables. However observing mean and variance within groups formed along the line of ```am``` variable could be of interest here. The boxplot in Figure II in Annex suggests that not only that cars with manual transmission have in average a higher consumption of fuel compared to automatic transmission cars, but also that within group variability in fuel consumption for the latter group is much narrower than the earlier.<br> However one should think of correcting for other variables before setting this conclusion in stone.
<hr width="100%" style="border: 2px dashed #000000" color="#FFFFFF" size="6"></hr>
<h3>3. Building our Model</h3>
One way of looking at the relation of interest correcting for additional counfounders is to make a multivariate regression model to fit the data. In this case, one only considers linear models. However, linear regressions depend on model selection heavily, in our case in inclusion and exclusion of variables.
To lighten the decision, a step regression in both ways is conduct with the Akaike Information Criterion from the different models as comparator statistic informing the best model. The use of this algorithm informs then the choice of inclusion and exclusion of variables.<br>
```{r, cache = TRUE, results = 'hide'}
full.model <- lm( mpg ~ ., data = data[, -7])
best.model <- step(full.model, direction = "both")
```
```{r, cache = TRUE}
summary(best.model)$call
```
The best model fit in the dataset is one including variable ```cyl```, ```hp```, ```wt``` and ```am``` according to AIC. That will be then the model of choice hereinafter.Now let's consider interactions between these different selected variables. Let's create a pairwise interaction variable for each four variables, then use the stepwise regression method to judge inclusion of interaction variables.<br>
```{r, cache = TRUE, results = 'hide'}
full.model1 <- lm(mpg ~ cyl+hp+wt+am+(cyl:am)+(cyl:hp)+(cyl:wt)+hp*wt+(hp:am)+(wt:am), data = data)
best.model1 <- step(full.model1, direction = "both")
```
```{r, cache = TRUE}
summary(best.model1)$call
```
Considering all pairwise interactions between variables in the dataset as regressors, the best model fit is given above. This will be then the end model used to make statistical inference of the model.<br>
<hr width="100%" style="border: 2px dashed #000000" color="#FFFFFF" size="6"></hr>
<h3>4. Statistical Inference and Coefficient Interpretation</h3>
First one can conduct a two sided t-test to look at the significance at 95% confidence level of difference in means of fuel consumption between a car with manual and automatic transmission, assuming unequal variances like observed in boxplot.
```{r, cache = TRUE}
t <- t.test(mpg ~ am, data = mtcars)
```
A p-value equal to ```r t$p.value``` > .05 of the t-test conducted permits to reject the null hypothesis of equal means. Also observe that the confidence interval [```r t$conf.int```] for this test does not include 0.<br>
Then data is fitted to model choose in the previous section, the results are displayed in *Chosen Model Fit* section of the Annex. Notice here that the intercept cannot have an interpretation as baseline values for weight and horse power are zero. A car with 0 weight and horse power is a *dead car*.<br>
First observe that for a confidence level at 95%, only estimates of the betas for variables hp wt am and of shift in mileage when passing from 4 to 8 cylinders and interaction variable of 8 cylinders level with hp are significant, they will be the only one interpreted.<br>
The mean loss in mileage for 1000 pounds gain in vehicle weight is estimated at ```r round(summary(best.model1)$coefficients[[5]],2)``` mpg and the mean loss in mileage for a horse power gain of one is estimated at ```r round(summary(best.model1)$coefficients[[4]],2)```. The two observations are of course made ceteris paribus. Ceteris paribus, the shift from automatic to manual transmission in a car will correspond to a gain of ```r round(summary(best.model1)$coefficients[[6]],2)``` mpg in mean mileage. In the same manner a shift from a 4 cylinders car to 8 cylinders cars will correspond to a gain of ```r round(summary(best.model1)$coefficients[[3]],2)``` mpg in mean mileage. Also the mean change in mileage due to horse power change when shifting from 4 cylinders cars to 8 cylinders car is estimated at ```r round(summary(best.model1)$coefficients[[9]],2)``` mpg.<br>
The R² gives a value of ```r summary(best.model1)$r.squared``` which means that our data explains ```r (summary(best.model1)$r.squared)*100```% of the variability in the data.<br>
<hr width="100%" style="border: 2px dashed #000000" color="#FFFFFF" size="6"></hr>
<h3>5. Residuals and Diagnostics</h3>
In this section, residual plots are made for the choose regression model: This will help of course point out to any problems in the residual of the fitted model and study the quality of fitness.<br>
The Residuals vs Fitted and Scale-Location graphs in residuals analysis plots in Figure III in the Annex shows no particular pattern. However the difference between the two red lines show the specially influential outliers namely, The Pontiac Firebird, The FIAT 128 and The Toyota Corolla. While the QQplot shows pretty normal residuals, the three points mentioned before are outstanding outliers. Three leverage points are pointed out to here, namely The Lotus Europa, The Maserati Bora and The Honda Civic. Let's then compute some regression diagnostics of the model to find out interesting leverage and influential points, and confirm visual observations.<br>
```{r, cache = TRUE}
influential <- dfbetas(best.model1); leverage <- hatvalues(best.model1) 
no <- head(sort(influential[,6], decreasing = TRUE),3); yes <- head(sort(leverage, decreasing = TRUE),3)
```
The results are significant departure of visual analysis of influential and leverage points in the dataset. In top 3 leverage data points ```r names(yes)``` all of them represent race cars with low mpg. In top 3 influential data points one finds ```r names(no)```An interesting thing to do would be to exclude these points to study the relationship of interest anew.
<hr width="100%" style="border: 2px dashed #000000" color="#FFFFFF" size="6"></hr>
<h3>6. Conclusion and Answers</h3>
In summary, after some initial change in data set, and summary of variables present in the data set, we conducted a exploratory data analysis that showed that there was in fact a statistically significant difference between the mileage of automatic transmission cars and manual transmission cars. We then selected some variables using stepwise regression and AIC and fitted data to the best model. This model makes use of variables ```cyl```, ```hp```, ```wt``` and ```am``` and some of their interactions. Then, correcting for the selected variables and some of their interactions, one finds that :

1. Manual transmissions are better for mileage (or MPG). 
2. Actually the gain makes for about 9.14 mpg ceteris paribus when shfiting from automatic to Manual transmission.

<hr width="100%" style="border: 2px dashed #000000" color="#FFFFFF" size="6"></hr>
<h3>7. Annex</h3>
<table class="center-div" border="1" style="width:100%">
<caption>Table I : Variables Description</caption>
<colgroup><col span="1" style="background-color:yellow"></colgroup>
<thead><tr><th>Variable Name</th><th>Description</th><th>Unit</th></tr></thead>
<tr><td>mpg</td><td>Fuel Consumption</td><td>US Miles per Gallon</td></tr>
<tr><td>cyl</td><td>Number of Cylinders</td><td>No Unit</td></tr>
<tr><td>disp</td><td>Engine Displacement</td><td>Cubic Inches</td></tr>
<tr><td>hp</td><td>Motor's Gross Horsepower</td><td>hp</td></tr>
<tr><td>drat</td><td>Rear Axle Ratio</td><td>No Units</td></tr>
<tr><td>wt</td><td>Vehicule weight</td><td>Thousand Tons</td></tr>
<tr><td>qsec</td><td>1/4 Mile Time</td><td>Seconds</td></tr>
<tr><td>vs</td><td>Engine Type</td><td>0 for V-Engine - 1 for Straight Engine</td></tr>
<tr><td>am</td><td>Transmission Type Dummy</td><td>0 for Automatic - 1 for Manual</td></tr>
<tr><td>gear</td><td>Number of Forward Gears</td><td>No Unit</td></tr>
<tr><td>carb</td><td>Number of Carburetors</td><td>No Unit</td></tr></table>
<center><h6>Data Summary</h6></center>
```{r, echo=TRUE}
c(summary(data$cyl), summary(data$vs), summary(data$am), summary(data$gear), summary(data$carb), summary(data$vs))
summary(data[,-c(1, 2, 7, 8, 9, 10, 11)])
```
<center><h6>Correlations</h6></center>
```{r, echo = TRUE,fig.align = 'center', fig.width = 9, fig.height = 9}
par(mfrow=c(1,1)); title <- "Figure II: Fuel Consumption by Transmission Type"
pairs(data[,-7], main="Figure I: Pairwise Scatterplot")
```
```{r, echo = TRUE, fig.align = 'center', fig.width = 6, fig.height = 5}
boxplot(mpg ~ am, data = data,main = title, xlab = "Transmission Type",ylab = "Fuel Consumption (mpg)")
```
<center><h6>Chosen Model Fit</h6></center>
```{r, echo = TRUE}
chosen <- lm(mpg ~ cyl + hp + wt + am + (cyl:hp) + (wt:am), data = data)
summary(chosen)$coefficients
```
<center><h6>Figure III: Residuals Plots</h6></center>
```{r, echo = TRUE, fig.width = 9, fig.height = 6 ,fig.align = 'center'}
par(mfrow=c(2, 2))
plot(best.model1)
```

</font>